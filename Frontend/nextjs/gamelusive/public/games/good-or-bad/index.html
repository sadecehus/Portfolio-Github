<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Good or Bad? - Decision Making Game</title>
    <script src="translations.js"></script>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background-color: #f5f7ff;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            background-color: #6a5acd;
            padding: 15px;
            border-radius: 15px;
            color: white;
        }
        h1 {
            margin: 0;
            font-size: 32px;
        }
        .subtitle {
            font-size: 18px;
            margin-top: 5px;
        }
        .level-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .level-btn {
            background-color: #e6e6fa;
            border: 3px solid transparent;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .level-btn:hover {
            background-color: #d8d8f0;
        }
        .level-btn.active {
            background-color: #6a5acd;
            color: white;
            border-color: #4a3aad;
        }
        .score-display {
            display: flex;
            justify-content: space-between;
            background-color: #e6e6fa;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
        }
        .scenario {
            background-color: #fff8dc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 18px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .scenario-image {
            width: 100%;
            height: 200px;
            background-color: #e0e0e0;
            margin-bottom: 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #666;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        .option {
            background-color: #f0f0f0;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }
        .option:hover {
            background-color: #e0e0e0;
        }
        .option.good {
            background-color: #d4edda;
        }
        .option.bad {
            background-color: #f8d7da;
        }
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        .feedback.correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .feedback.incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .feedback h3 {
            margin-top: 0;
        }
        .next-btn {
            background-color: #6a5acd;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            font-weight: bold;
        }
        .next-btn:hover {
            background-color: #5949b5;
        }
        .results {
            text-align: center;
            display: none;
        }
        .results h2 {
            color: #6a5acd;
            font-size: 28px;
        }
        .trophy {
            font-size: 60px;
            margin: 20px 0;
        }
        .action-btn {
            background-color: #6a5acd;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
        }
        .action-btn:hover {
            background-color: #5949b5;
        }
        .option-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            text-align: center;
            line-height: 24px;
            border-radius: 50%;
        }
        .good-icon {
            background-color: #28a745;
            color: white;
        }
        .bad-icon {
            background-color: #dc3545;
            color: white;
        }
        .home-screen {
            text-align: center;
            padding: 30px;
        }
        .home-screen h2 {
            color: #6a5acd;
            margin-bottom: 20px;
        }
        .character {
            font-size: 80px;
            margin: 20px 0;
        }
        .btn-large {
            background-color: #6a5acd;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 20px;
            cursor: pointer;
            margin: 10px;
            font-weight: bold;
        }
        .btn-large:hover {
            background-color: #5949b5;
        }
        .language-selector {
            background-color: #fff;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .language-selector h3 {
            margin: 0 0 8px 0;
        }
        .language-btn {
            background-color: #6a5acd;
            color: #fff;
            border: none;
            padding: 6px 12px;
            border-radius: 16px;
            cursor: pointer;
            margin: 2px 6px 0 0;
            font-size: 14px;
        }
        .language-btn.active { background-color: #4a3aad; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1></h1>
            <div class="subtitle"></div>
        </header>
        <div class="language-selector">
            <h3>Select Language:</h3>
            <!-- Language buttons injected by initLanguageSelector() -->
        </div>

        <!-- Home Screen -->
        <div id="home-screen" class="home-screen">
            <h2 id="home-title"></h2>
            <p id="home-description"></p>
            <div class="character">üëßüë¶</div>
            <h3 id="choose-level"></h3>
            <button class="btn-large" id="younger-btn"></button>
            <button class="btn-large" id="older-btn"></button>
        </div>

        <!-- Game Screen (initially hidden) -->
        <div id="game-screen" style="display: none;">
            <div class="level-selector">
                <button class="level-btn active" id="younger-level-btn"></button>
                <button class="level-btn" id="older-level-btn"></button>
            </div>

            <div class="score-display">
                <div><span id="question-label">Question</span>: <span id="current-question">1</span>/<span id="total-questions">8</span></div>
                <div><span id="score-label">Score</span>: <span id="score">0</span></div>
            </div>

            <div id="game-container">
                <div class="scenario" id="scenario-display">
                    <div class="scenario-image" id="scenario-image"></div>
                    <p id="scenario-text">Loading scenario...</p>
                    <div class="options" id="options-container">
                        <!-- Options will be added here -->
                    </div>
                    <div class="feedback" id="feedback-container">
                        <h3 id="feedback-title">Feedback</h3>
                        <p id="feedback-text"></p>
                    </div>
                </div>
                <button class="next-btn" id="next-btn" style="display: none;">Next Question</button>
            </div>

            <div class="results" id="results-container">
                <h2 id="game-complete-title">Game Complete!</h2>
                <p><span id="you-scored-label">You scored</span> <span id="final-score">0</span> <span id="out-of-label">out of</span> <span id="max-score">8</span>!</p>
                <div class="trophy">üèÜ</div>
                <p id="result-message">Great job making good choices!</p>
                <div>
                    <button class="action-btn" id="play-again-btn">Play Again</button>
                    <button class="action-btn" id="home-btn">Home</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // expose currentLevel for translations.js
        window.currentLevel = 'younger';

        // Game data - scenarios with options
        const youngerScenarios = (getText && getText('youngerScenarios')) || [
            {
                text: "Sarah sees a classmate drop their pencil case. What should she do?",
                options: [
                    { text: "Pick it up and return it to her classmate", isGood: true, feedback: "Great choice! Helping others is always a good thing to do." },
                    { text: "Ignore it and continue walking", isGood: false, feedback: "It would be better to help your classmate by picking up their pencil case." },
                    { text: "Pick it up and keep it for herself", isGood: false, feedback: "Taking something that belongs to someone else isn't right. It's better to return it." }
                ]
            },
            {
                text: "Max sees another student sitting alone at lunch. What should he do?",
                options: [
                    { text: "Ask the student if they want to join him and his friends", isGood: true, feedback: "Excellent! Including others helps everyone feel welcome." },
                    { text: "Ignore the student and continue eating with his friends", isGood: false, feedback: "When someone is alone, it's nice to invite them to join you." },
                    { text: "Tell his friends to laugh at the student sitting alone", isGood: false, feedback: "Making fun of others can hurt their feelings. It's better to be kind." }
                ]
            },
            {
                text: "Jamie broke a classroom toy by accident. What should he do?",
                options: [
                    { text: "Tell the teacher what happened and apologize", isGood: true, feedback: "Being honest when you make a mistake is the right thing to do!" },
                    { text: "Hide the broken toy so no one will know", isGood: false, feedback: "Hiding mistakes doesn't solve problems. It's better to be honest." },
                    { text: "Blame another student for breaking it", isGood: false, feedback: "Blaming others for your mistakes isn't honest or fair." }
                ]
            },
            {
                text: "Emma notices her friend doesn't understand how to do something. What should she do?",
                options: [
                    { text: "Offer to help explain it", isGood: true, feedback: "Helping friends learn is a kind and supportive thing to do!" },
                    { text: "Tell her friend they're not smart enough", isGood: false, feedback: "Saying hurtful things doesn't help anyone. Supporting friends is better." },
                    { text: "Walk away and leave her friend confused", isGood: false, feedback: "Friends help each other when they need it. Walking away isn't helpful." }
                ]
            },
            {
                text: "Noah sees someone pushing other kids on the playground. What should he do?",
                options: [
                    { text: "Tell a teacher about what's happening", isGood: true, feedback: "Good job! Getting help from an adult is the right thing to do when someone might get hurt." },
                    { text: "Join in and start pushing kids too", isGood: false, feedback: "Pushing others can hurt them and isn't a safe way to play." },
                    { text: "Watch and do nothing about it", isGood: false, feedback: "When others might get hurt, it's important to get help instead of doing nothing." }
                ]
            },
            {
                text: "Lily finds a toy in the school hallway. What should she do?",
                options: [
                    { text: "Take it to the teacher right away", isGood: true, feedback: "Perfect! Turning in lost items is honest and helps the person who lost it." },
                    { text: "Keep the toy for herself", isGood: false, feedback: "Taking something that isn't yours isn't honest. It's best to turn it in." },
                    { text: "Hide it in someone else's desk", isGood: false, feedback: "Hiding things in other people's desks can get them in trouble for something they didn't do." }
                ]
            },
            {
                text: "Ben forgot to bring his lunch to school. What should he do?",
                options: [
                    { text: "Ask an adult for help", isGood: true, feedback: "Asking for help when you need it is a smart choice!" },
                    { text: "Take another student's lunch when they aren't looking", isGood: false, feedback: "Taking something without permission isn't right, even if you're hungry." },
                    { text: "Not eat anything and stay hungry all day", isGood: false, feedback: "It's important to ask for help when you need it rather than staying hungry." }
                ]
            },
            {
                text: "Sofia sees a new student who looks nervous on their first day. What should she do?",
                options: [
                    { text: "Introduce herself and offer to be their friend", isGood: true, feedback: "Wonderful! Being friendly to new students helps them feel welcome." },
                    { text: "Ignore the new student", isGood: false, feedback: "Starting at a new school can be scary. Being friendly helps new students feel welcome." },
                    { text: "Tell other students not to talk to the new kid", isGood: false, feedback: "Excluding others can hurt their feelings. Being welcoming is a better choice." }
                ]
            }
        ];

        const olderScenarios = (getText && getText('olderScenarios')) || [
            {
                text: "Tyler accidentally breaks his friend's new pencil. What should he do?",
                options: [
                    { text: "Apologize and offer to replace it", isGood: true, feedback: "Taking responsibility and making things right shows you care about others!" },
                    { text: "Hide the broken pencil", isGood: false, feedback: "Hiding mistakes doesn't fix them. Apologizing and making it right is better." },
                    { text: "Tell his friend to be more careful with his things", isGood: false, feedback: "Blaming others for accidents isn't kind. Apologizing is a better choice." }
                ]
            },
            {
                text: "Olivia hears her friends saying mean things about another student. What should she do?",
                options: [
                    { text: "Tell her friends that saying mean things isn't nice", isGood: true, feedback: "Standing up for others is brave and kind. Great choice!" },
                    { text: "Join in and say mean things too", isGood: false, feedback: "Saying mean things about others can hurt their feelings. It's better to be kind." },
                    { text: "Say nothing and continue listening", isGood: false, feedback: "When you hear unkind words, speaking up can help stop hurtful behavior." }
                ]
            },
            {
                text: "Miguel finds $5 on the classroom floor and no one sees him pick it up. What should he do?",
                options: [
                    { text: "Give it to the teacher in case someone is looking for it", isGood: true, feedback: "Turning in found money is honest and shows integrity!" },
                    { text: "Keep it and use it to buy candy after school", isGood: false, feedback: "Even if no one saw you find it, keeping found money that might belong to someone else isn't honest." },
                    { text: "Tell everyone he earned the money himself", isGood: false, feedback: "Making up stories about how you got something isn't truthful." }
                ]
            },
            {
                text: "Zoe has a lot of homework and her friend offers to let her copy their answers. What should she do?",
                options: [
                    { text: "Decline and do her own work, even if it takes longer", isGood: true, feedback: "Doing your own work helps you learn and is the honest thing to do!" },
                    { text: "Copy the answers so she can finish quickly", isGood: false, feedback: "Copying someone else's work doesn't help you learn and isn't honest." },
                    { text: "Copy just a few answers and change the rest", isGood: false, feedback: "Even copying some answers isn't your own work. It's best to do it yourself." }
                ]
            },
            {
                text: "During a test, Alex notices another student looking at his answers. What should he do?",
                options: [
                    { text: "Cover his paper and tell the teacher after the test", isGood: true, feedback: "Good choice! Protecting your work and reporting problems to an adult is responsible." },
                    { text: "Show the student his answers on purpose", isGood: false, feedback: "Helping someone cheat doesn't help them learn and isn't honest." },
                    { text: "Yell at the student during the test", isGood: false, feedback: "Disrupting the class isn't helpful. Quietly protecting your work and telling the teacher later is better." }
                ]
            },
            {
                text: "Isabella sees that someone wrote on the bathroom wall. What should she do?",
                options: [
                    { text: "Tell a teacher or staff member about it", isGood: true, feedback: "Reporting damage helps keep the school clean and nice for everyone!" },
                    { text: "Add her own drawing next to it", isGood: false, feedback: "Adding to graffiti damages school property even more." },
                    { text: "Tell other students to come see the funny writing", isGood: false, feedback: "Drawing attention to vandalism might encourage more students to do it." }
                ]
            },
            {
                text: "Nathan's team loses a game and he feels upset. What should he do?",
                options: [
                    { text: "Congratulate the other team and practice more for next time", isGood: true, feedback: "Being a good sport when you lose shows character and respect!" },
                    { text: "Refuse to shake hands with the other team", isGood: false, feedback: "Good sportsmanship means being respectful even when you lose." },
                    { text: "Blame his teammates for the loss", isGood: false, feedback: "Blaming others doesn't help the team. Supporting each other and practicing is better." }
                ]
            },
            {
                text: "Ava's friend asks her to keep a secret that involves breaking a school rule. What should she do?",
                options: [
                    { text: "Tell her friend she can't keep secrets about breaking rules", isGood: true, feedback: "Good choice! Some secrets shouldn't be kept, especially if rules are being broken." },
                    { text: "Promise to keep the secret no matter what", isGood: false, feedback: "Some secrets can be harmful and shouldn't be kept, especially about breaking rules." },
                    { text: "Tell everyone at school about the secret", isGood: false, feedback: "Telling everyone would betray your friend's trust. It's better to just tell an adult if needed." }
                ]
            }
        ];

        // Game state
        let currentScenarioIndex = 0;
        let score = 0;
        let selectedOptionIndex = -1;
        let currentScenarios = [];
    let currentLevel = 'younger';

        // DOM elements
        const homeScreen = document.getElementById('home-screen');
        const gameScreen = document.getElementById('game-screen');
        const scenarioTextElement = document.getElementById('scenario-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackText = document.getElementById('feedback-text');
        const nextButton = document.getElementById('next-btn');
        const currentQuestionElement = document.getElementById('current-question');
        const totalQuestionsElement = document.getElementById('total-questions');
        const scoreElement = document.getElementById('score');
        const gameContainer = document.getElementById('game-container');
        const resultsContainer = document.getElementById('results-container');
        const finalScoreElement = document.getElementById('final-score');
        const maxScoreElement = document.getElementById('max-score');
        const resultMessageElement = document.getElementById('result-message');
        const youngerLevelBtn = document.getElementById('younger-level-btn');
        const olderLevelBtn = document.getElementById('older-level-btn');
        const youngerBtn = document.getElementById('younger-btn');
        const olderBtn = document.getElementById('older-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const homeBtn = document.getElementById('home-btn');

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize the game with selected level
        function initGame(level) {
            currentLevel = level;
            window.currentLevel = level;
            currentScenarioIndex = 0;
            score = 0;
            
            // Set active level button
            if (level === 'younger') {
                youngerLevelBtn.classList.add('active');
                olderLevelBtn.classList.remove('active');
                const src = (typeof getText === 'function' && getText('youngerScenarios')) || youngerScenarios;
                currentScenarios = JSON.parse(JSON.stringify(src)); // Deep copy
            } else {
                olderLevelBtn.classList.add('active');
                youngerLevelBtn.classList.remove('active');
                const src = (typeof getText === 'function' && getText('olderScenarios')) || olderScenarios;
                currentScenarios = JSON.parse(JSON.stringify(src)); // Deep copy
            }
            
            // Shuffle the order of scenarios
            currentScenarios = shuffleArray(currentScenarios);
            
            // Update UI
            totalQuestionsElement.textContent = currentScenarios.length;
            scoreElement.textContent = score;
            gameContainer.style.display = 'block';
            resultsContainer.style.display = 'none';
            
            // Show game screen
            homeScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            
            displayScenario();
        }

        // Display current scenario
        function displayScenario() {
            const scenario = currentScenarios[currentScenarioIndex];
            scenarioTextElement.textContent = scenario.text;
            scenarioTextElement.dataset.hasContent = 'true';
            currentQuestionElement.textContent = currentScenarioIndex + 1;
            
            // Clear previous options
            optionsContainer.innerHTML = '';
            
            // Shuffle options
            const shuffledOptions = shuffleArray([...scenario.options]);
            
            // Add options
            shuffledOptions.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-icon ${option.isGood ? 'good-icon' : 'bad-icon'}" style="display: none;">${option.isGood ? '‚úì' : '‚úó'}</div>
                    <span>${option.text}</span>
                `;
                optionElement.addEventListener('click', () => selectOption(shuffledOptions.indexOf(option)));
                optionsContainer.appendChild(optionElement);
            });
            
            // Store shuffled options back in the scenario
            currentScenarios[currentScenarioIndex].shuffledOptions = shuffledOptions;
            
            // Hide feedback and next button
            feedbackContainer.style.display = 'none';
            nextButton.style.display = 'none';
            selectedOptionIndex = -1;
        }

        // Handle option selection
        function selectOption(index) {
            // If already selected an option, do nothing
            if (selectedOptionIndex !== -1) return;
            
            selectedOptionIndex = index;
            const scenario = currentScenarios[currentScenarioIndex];
            const selectedOption = scenario.shuffledOptions[index];
            const optionElements = document.querySelectorAll('.option');
            
            // Show all good/bad icons
            const iconElements = document.querySelectorAll('.option-icon');
            iconElements.forEach(icon => icon.style.display = 'block');
            
            // Apply styling to options
            optionElements.forEach((opt, i) => {
                if (scenario.shuffledOptions[i].isGood) {
                    opt.classList.add('good');
                } else {
                    opt.classList.add('bad');
                }
            });
            
            // Show feedback
            feedbackContainer.style.display = 'block';
            if (selectedOption.isGood) {
                feedbackContainer.className = 'feedback correct';
                feedbackTitle.textContent = getText('feedbackCorrectTitle');
                score++;
                scoreElement.textContent = score;
            } else {
                feedbackContainer.className = 'feedback incorrect';
                feedbackTitle.textContent = getText('feedbackIncorrectTitle');
            }
            feedbackText.textContent = selectedOption.feedback;
            
            // Show next button
            nextButton.style.display = 'block';
        }

        // Go to next scenario
        function nextScenario() {
            currentScenarioIndex++;
            if (currentScenarioIndex < currentScenarios.length) {
                displayScenario();
            } else {
                showResults();
            }
        }

        // Show final results
        function showResults() {
            gameContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
            finalScoreElement.textContent = score;
            maxScoreElement.textContent = currentScenarios.length;
            
            // Set appropriate message based on score
            if (score === currentScenarios.length) {
                resultMessageElement.textContent = getText('resultMessagePerfect');
            } else if (score >= currentScenarios.length * 0.7) {
                resultMessageElement.textContent = getText('resultMessageGreat');
            } else if (score >= currentScenarios.length * 0.5) {
                resultMessageElement.textContent = getText('resultMessageGood');
            } else {
                resultMessageElement.textContent = getText('resultMessageKeepLearning');
            }
        }

        // Return to home screen
        function goToHome() {
            gameScreen.style.display = 'none';
            homeScreen.style.display = 'block';
        }

        // Event listeners
        youngerBtn.addEventListener('click', () => initGame('younger'));
        olderBtn.addEventListener('click', () => initGame('older'));
        youngerLevelBtn.addEventListener('click', () => initGame('younger'));
        olderLevelBtn.addEventListener('click', () => initGame('older'));
        nextButton.addEventListener('click', nextScenario);
        playAgainBtn.addEventListener('click', () => initGame(currentLevel));
        homeBtn.addEventListener('click', goToHome);

        // Initialize language selector and UI on load
        window.addEventListener('load', () => {
            if (typeof initLanguageSelector === 'function') initLanguageSelector();
            if (typeof updateUI === 'function') updateUI();
        });
    </script>
</body>
</html>