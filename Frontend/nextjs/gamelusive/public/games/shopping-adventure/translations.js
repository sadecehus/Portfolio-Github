// Translations for Shopping Adventure
const translations = {
  en: {
    title: "Shopping Adventure - Supermarket Game",
    headerTitle: "Shopping Adventure",
    headerSubtitle: "Collect ingredients from the recipe card and guess the dish!",
    selectLanguage: "Select Language:",
    score: "Score",
    recipeTitle: "Secret Recipe",
    supermarketTitle: "Supermarket Shelves",
    basketTitle: "My Shopping Cart",
    guessPlaceholder: "What dish can be made with these ingredients?",
    guessButton: "Make a Guess! 🍽️",
    newRecipeButton: "New Recipe 🔄",
    missingLabel: "Missing",
    messages: {
      itemAdded: "🎉 {icon} {item} added to cart! Great choice! 🎉",
      itemAlready: "🤔 {icon} {item} is already in your cart!",
      removed: "🗑️ Removed from cart! Click again to add back!",
      pleaseWriteGuess: "Please write a guess!",
      perfectGuess: "🎊 AMAZING! Perfect guess: {recipe}! All ingredients correct! You're a master chef! 🧑‍🍳 (+10 points)",
      goodGuessMissing: "🎯 Good job! Correct dish: {recipe}! Missing: {missing} - Try to get all ingredients next time! (+5 points)",
      wrongGuess: "🤯 Oops! Wrong guess! The correct answer was: {recipe}. Don't give up, try the next recipe! 💪",
      onFire: "🏆 You're on fire! Keep going, champion! 🔥"
    },
    items: {
      "pasta": "pasta",
      "tomato": "tomato",
      "cheese": "cheese",
      "onion": "onion",
      "egg": "egg",
      "milk": "milk",
      "lettuce": "lettuce",
      "cucumber": "cucumber",
      "olive oil": "olive oil",
      "chicken": "chicken",
      "carrot": "carrot",
      "potato": "potato",
      "dough": "dough",
      "olive": "olive",
      "bread": "bread",
      "flour": "flour",
      "sugar": "sugar",
      "apple": "apple",
      "banana": "banana",
      "fish": "fish"
    },
    recipeNames: {
      pasta: "Pasta",
      omelet: "Omelet",
      salad: "Salad",
      soup: "Soup",
      pizza: "Pizza",
      sandwich: "Sandwich",
      cake: "Cake"
    },
    recipeAlternatives: {
      pasta: ["pasta", "spaghetti", "noodles"],
      omelet: ["omelet", "omelette", "scrambled eggs"],
      salad: ["salad", "green salad", "vegetable salad"],
      soup: ["soup", "chicken soup", "broth"],
      pizza: ["pizza"],
      sandwich: ["sandwich", "sub", "toast"],
      cake: ["cake", "sponge cake", "batter cake"]
    }
  },

  tr: {
    title: "Alışveriş Macerası - Süpermarket Oyunu",
    headerTitle: "Alışveriş Macerası",
    headerSubtitle: "Tarif kartındaki malzemeleri topla ve yemeği tahmin et!",
    selectLanguage: "Dil Seçin:",
    score: "Puan",
    recipeTitle: "Gizli Tarif",
    supermarketTitle: "Market Rafları",
    basketTitle: "Alışveriş Sepetim",
    guessPlaceholder: "Bu malzemelerle hangi yemek yapılır?",
    guessButton: "Tahmin Et! 🍽️",
    newRecipeButton: "Yeni Tarif 🔄",
    missingLabel: "Eksik",
    messages: {
      itemAdded: "🎉 {icon} {item} sepete eklendi! Harika seçim! 🎉",
      itemAlready: "🤔 {icon} {item} zaten sepetinde!",
      removed: "🗑️ Sepetten çıkarıldı! Eklemek için tekrar tıkla!",
      pleaseWriteGuess: "Lütfen bir tahmin yaz!",
      perfectGuess: "🎊 MUHTEŞEM! Doğru tahmin: {recipe}! Tüm malzemeler doğru! Harika bir aşçısın! 🧑‍🍳 (+10 puan)",
      goodGuessMissing: "🎯 Aferin! Doğru yemek: {recipe}! Eksik: {missing} - Bir dahaki sefere tüm malzemeleri toplamayı dene! (+5 puan)",
      wrongGuess: "🤯 Oops! Yanlış tahmin! Doğru cevap: {recipe}. Pes etme, sıradaki tarifi dene! 💪",
      onFire: "🏆 Harikasın! Böyle devam et, şampiyon! 🔥"
    },
    items: {
      "pasta": "makarna",
      "tomato": "domates",
      "cheese": "peynir",
      "onion": "soğan",
      "egg": "yumurta",
      "milk": "süt",
      "lettuce": "marul",
      "cucumber": "salatalık",
      "olive oil": "zeytinyağı",
      "chicken": "tavuk",
      "carrot": "havuç",
      "potato": "patates",
      "dough": "hamur",
      "olive": "zeytin",
      "bread": "ekmek",
      "flour": "un",
      "sugar": "şeker",
      "apple": "elma",
      "banana": "muz",
      "fish": "balık"
    },
    recipeNames: {
      pasta: "Makarna",
      omelet: "Omlet",
      salad: "Salata",
      soup: "Çorba",
      pizza: "Pizza",
      sandwich: "Sandviç",
      cake: "Kek"
    },
    recipeAlternatives: {
      pasta: ["makarna", "spagetti", "spaghetti", "erişte"],
      omelet: ["omlet", "çırpılmış yumurta"],
      salad: ["salata", "yeşil salata", "sebze salatası"],
      soup: ["çorba", "tavuk çorbası", "tavuk suyu"],
      pizza: ["pizza"],
      sandwich: ["sandviç", "tost"],
      cake: ["kek", "pandispanya"]
    }
  },

  pl: {
    title: "Przygoda Zakupowa - Gra Supermarket",
    headerTitle: "Przygoda Zakupowa",
    headerSubtitle: "Zbierz składniki z karty przepisu i odgadnij danie!",
    selectLanguage: "Wybierz język:",
    score: "Wynik",
    recipeTitle: "Tajny Przepis",
    supermarketTitle: "Półki w Supermarkecie",
    basketTitle: "Mój Koszyk",
    guessPlaceholder: "Jakie danie można zrobić z tych składników?",
    guessButton: "Zgadnij! 🍽️",
    newRecipeButton: "Nowy Przepis 🔄",
    missingLabel: "Brakuje",
    messages: {
      itemAdded: "🎉 {icon} {item} dodano do koszyka! Świetny wybór! 🎉",
      itemAlready: "🤔 {icon} {item} już jest w Twoim koszyku!",
      removed: "🗑️ Usunięto z koszyka! Kliknij ponownie, aby dodać!",
      pleaseWriteGuess: "Proszę wpisz swoją odpowiedź!",
      perfectGuess: "🎊 WSPANIALE! Trafione: {recipe}! Wszystkie składniki poprawne! Jesteś mistrzem kuchni! 🧑‍🍳 (+10 punktów)",
      goodGuessMissing: "🎯 Dobra robota! Poprawne danie: {recipe}! Brakuje: {missing} - Spróbuj następnym razem zebrać wszystkie składniki! (+5 punktów)",
      wrongGuess: "🤯 Ups! Zła odpowiedź! Poprawna to: {recipe}. Nie poddawaj się, spróbuj kolejnego przepisu! 💪",
      onFire: "🏆 Idzie świetnie! Tak trzymaj, mistrzu! 🔥"
    },
    items: {
      "pasta": "makaron",
      "tomato": "pomidor",
      "cheese": "ser",
      "onion": "cebula",
      "egg": "jajko",
      "milk": "mleko",
      "lettuce": "sałata",
      "cucumber": "ogórek",
      "olive oil": "oliwa z oliwek",
      "chicken": "kurczak",
      "carrot": "marchewka",
      "potato": "ziemniak",
      "dough": "ciasto",
      "olive": "oliwka",
      "bread": "chleb",
      "flour": "mąka",
      "sugar": "cukier",
      "apple": "jabłko",
      "banana": "banan",
      "fish": "ryba"
    },
    recipeNames: {
      pasta: "Makaron",
      omelet: "Omlet",
      salad: "Sałatka",
      soup: "Zupa",
      pizza: "Pizza",
      sandwich: "Kanapka",
      cake: "Ciasto"
    },
    recipeAlternatives: {
      pasta: ["makaron", "spaghetti"],
      omelet: ["omlet", "jajecznica"],
      salad: ["sałatka", "sałatka warzywna"],
      soup: ["zupa", "rosół", "zupa z kurczaka"],
      pizza: ["pizza"],
      sandwich: ["kanapka", "sandwich", "tost"],
      cake: ["ciasto", "biszkopt"]
    }
  },

  nl: {
    title: "Winkelavontuur - Supermarktspel",
    headerTitle: "Winkelavontuur",
    headerSubtitle: "Verzamel ingrediënten van de receptkaart en raad het gerecht!",
    selectLanguage: "Selecteer taal:",
    score: "Score",
    recipeTitle: "Geheim Recept",
    supermarketTitle: "Supermarkt Schappen",
    basketTitle: "Mijn Winkelmand",
    guessPlaceholder: "Welk gerecht kun je met deze ingrediënten maken?",
    guessButton: "Doe een gok! 🍽️",
    newRecipeButton: "Nieuw Recept 🔄",
    missingLabel: "Ontbreekt",
    messages: {
      itemAdded: "🎉 {icon} {item} toegevoegd aan mand! Topkeuze! 🎉",
      itemAlready: "🤔 {icon} {item} zit al in je mand!",
      removed: "🗑️ Verwijderd uit mand! Klik opnieuw om toe te voegen!",
      pleaseWriteGuess: "Vul een gok in!",
      perfectGuess: "🎊 GEWELDIG! Perfect geraden: {recipe}! Alle ingrediënten kloppen! Je bent een topchef! 🧑‍🍳 (+10 punten)",
      goodGuessMissing: "🎯 Goed gedaan! Juist gerecht: {recipe}! Ontbreekt: {missing} - Probeer de volgende keer alle ingrediënten te pakken! (+5 punten)",
      wrongGuess: "🤯 Oeps! Verkeerd! Het juiste antwoord was: {recipe}. Niet opgeven, probeer het volgende recept! 💪",
      onFire: "🏆 Je gaat als een speer! Ga zo door, kampioen! 🔥"
    },
    items: {
      "pasta": "pasta",
      "tomato": "tomaat",
      "cheese": "kaas",
      "onion": "ui",
      "egg": "ei",
      "milk": "melk",
      "lettuce": "sla",
      "cucumber": "komkommer",
      "olive oil": "olijfolie",
      "chicken": "kip",
      "carrot": "wortel",
      "potato": "aardappel",
      "dough": "deeg",
      "olive": "olijf",
      "bread": "brood",
      "flour": "bloem",
      "sugar": "suiker",
      "apple": "appel",
      "banana": "banaan",
      "fish": "vis"
    },
    recipeNames: {
      pasta: "Pasta",
      omelet: "Omelet",
      salad: "Salade",
      soup: "Soep",
      pizza: "Pizza",
      sandwich: "Broodje",
      cake: "Taart"
    },
    recipeAlternatives: {
      pasta: ["pasta", "spaghetti"],
      omelet: ["omelet", "roerei"],
      salad: ["salade", "groene salade"],
      soup: ["soep", "kippensoep", "bouillon"],
      pizza: ["pizza"],
      sandwich: ["broodje", "sandwich", "tosti"],
      cake: ["taart", "cake"]
    }
  },

  lt: {
    title: "Apsipirkimo Nuotykis - Supermarketo Žaidimas",
    headerTitle: "Apsipirkimo Nuotykis",
    headerSubtitle: "Surink ingredientus iš recepto kortelės ir atspėk patiekalą!",
    selectLanguage: "Pasirinkti kalbą:",
    score: "Taškai",
    recipeTitle: "Slaptas Receptas",
    supermarketTitle: "Supermarketo Lentynos",
    basketTitle: "Mano Krepšelis",
    guessPlaceholder: "Kokį patiekalą galima pagaminti iš šių ingredientų?",
    guessButton: "Spėti! 🍽️",
    newRecipeButton: "Naujas Receptas 🔄",
    missingLabel: "Trūksta",
    messages: {
      itemAdded: "🎉 {icon} {item} pridėta į krepšelį! Puikus pasirinkimas! 🎉",
      itemAlready: "🤔 {icon} {item} jau yra tavo krepšelyje!",
      removed: "🗑️ Pašalinta iš krepšelio! Spustelėk dar kartą, kad pridėtum!",
      pleaseWriteGuess: "Įrašyk spėjimą!",
      perfectGuess: "🎊 NUOSTABU! Teisingas spėjimas: {recipe}! Visi ingredientai teisingi! Tu – virtuvės meistras! 🧑‍🍳 (+10 taškų)",
      goodGuessMissing: "🎯 Šaunu! Teisingas patiekalas: {recipe}! Trūksta: {missing} - Kitą kartą pabandyk surinkti visus ingredientus! (+5 taškai)",
      wrongGuess: "🤯 Oi! Neteisinga! Teisingas atsakymas buvo: {recipe}. Nenuleisk rankų, bandyk kitą receptą! 💪",
      onFire: "🏆 Tau puikiai sekasi! Taip ir toliau, čempione! 🔥"
    },
    items: {
      "pasta": "makaronai",
      "tomato": "pomidoras",
      "cheese": "sūris",
      "onion": "svogūnas",
      "egg": "kiaušinis",
      "milk": "pienas",
      "lettuce": "salotos",
      "cucumber": "agurkas",
      "olive oil": "alyvuogių aliejus",
      "chicken": "vištiena",
      "carrot": "morka",
      "potato": "bulvė",
      "dough": "tešla",
      "olive": "alyvuogė",
      "bread": "duona",
      "flour": "miltai",
      "sugar": "cukrus",
      "apple": "obuolys",
      "banana": "bananas",
      "fish": "žuvis"
    },
    recipeNames: {
      pasta: "Makaronai",
      omelet: "Omletas",
      salad: "Salotos",
      soup: "Sriuba",
      pizza: "Pica",
      sandwich: "Sumuštinis",
      cake: "Pyragas"
    },
    recipeAlternatives: {
      pasta: ["makaronai", "spagečiai"],
      omelet: ["omletas", "plakta kiaušinienė"],
      salad: ["salotos", "daržovių salotos"],
      soup: ["sriuba", "vištienos sriuba", "sultinys"],
      pizza: ["pica"],
      sandwich: ["sumuštinis", "tostas"],
      cake: ["pyragas", "biskvitas"]
    }
  }
};

let currentLanguage = 'en';

function getText(key) {
  const langTable = translations[currentLanguage] || translations.en;
  return langTable[key] || translations.en[key] || key;
}

function getMessage(key, vars = {}) {
  const msgs = (translations[currentLanguage] && translations[currentLanguage].messages) || translations.en.messages;
  let tmpl = msgs[key] || translations.en.messages[key] || '';
  return tmpl.replace(/\{(\w+)\}/g, (_, v) => vars[v] ?? '');
}

function getItemName(key) {
  const langTable = translations[currentLanguage] || translations.en;
  return (langTable.items && langTable.items[key]) || translations.en.items[key] || key;
}

function getRecipeName(id) {
  const langTable = translations[currentLanguage] || translations.en;
  return (langTable.recipeNames && langTable.recipeNames[id]) || translations.en.recipeNames[id] || id;
}

function getRecipeAlternatives(id) {
  const langTable = translations[currentLanguage] || translations.en;
  return (langTable.recipeAlternatives && langTable.recipeAlternatives[id]) || translations.en.recipeAlternatives[id] || [];
}

function updateUI() {
  document.title = getText('title');
  const html = document.documentElement;
  html.lang = currentLanguage;

  const headerH1 = document.querySelector('.header h1');
  if (headerH1) headerH1.textContent = `🛒 ${getText('headerTitle')}`;
  const headerP = document.querySelector('.header p');
  if (headerP) headerP.textContent = getText('headerSubtitle');

  const langH3 = document.querySelector('.language-selector h3');
  if (langH3) langH3.textContent = getText('selectLanguage');

  const scoreH3 = document.querySelector('.score h3');
  if (scoreH3) scoreH3.textContent = getText('score');

  const recipeTitle = document.getElementById('recipeTitle');
  if (recipeTitle) recipeTitle.textContent = getText('recipeTitle');

  const marketH2 = document.querySelector('.supermarket h2');
  if (marketH2) marketH2.textContent = `🏪 ${getText('supermarketTitle')}`;

  const basketH3 = document.querySelector('#basket h3');
  if (basketH3) basketH3.textContent = getText('basketTitle');

  const guessInput = document.getElementById('guessInput');
  if (guessInput) guessInput.placeholder = getText('guessPlaceholder');

  const guessBtn = document.getElementById('guessBtn');
  if (guessBtn) guessBtn.textContent = getText('guessButton');

  const newRecipeBtn = document.getElementById('newRecipeBtn');
  if (newRecipeBtn) newRecipeBtn.textContent = getText('newRecipeButton');
}

function changeLanguage(lang) {
  if (!translations[lang]) return;
  currentLanguage = lang;
  updateUI();
  if (typeof window.refreshLocalizedData === 'function') {
    window.refreshLocalizedData();
  }
}

function initLanguageSelector() {
  const container = document.querySelector('.language-selector');
  if (!container) return;
  // Avoid duplicates
  if (container.querySelector('.language-btn')) return;
  const languages = [
    { code: 'en', name: ' 🇬🇧 English' },
    { code: 'tr', name: ' 🇹🇷 Türkçe' },
    { code: 'pl', name: ' 🇵🇱 Polski' },
    { code: 'nl', name: ' 🇳🇱 Nederlands' },
    { code: 'lt', name: ' 🇱🇹 Lietuvių' }
  ];
  languages.forEach(lang => {
    const btn = document.createElement('button');
    btn.className = 'language-btn';
    btn.textContent = lang.name;
    btn.onclick = () => {
      document.querySelectorAll('.language-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      changeLanguage(lang.code);
    };
    if (lang.code === currentLanguage) btn.classList.add('active');
    container.appendChild(btn);
  });
}
