// Translations for Shopping Adventure
const translations = {
  en: {
    title: "Shopping Adventure - Supermarket Game",
    headerTitle: "Shopping Adventure",
    headerSubtitle: "Collect ingredients from the recipe card and guess the dish!",
    selectLanguage: "Select Language:",
    score: "Score",
    recipeTitle: "Secret Recipe",
    supermarketTitle: "Supermarket Shelves",
    basketTitle: "My Shopping Cart",
    guessPlaceholder: "What dish can be made with these ingredients?",
    guessButton: "Make a Guess! ðŸ½ï¸",
    newRecipeButton: "New Recipe ðŸ”„",
    missingLabel: "Missing",
    messages: {
      itemAdded: "ðŸŽ‰ {icon} {item} added to cart! Great choice! ðŸŽ‰",
      itemAlready: "ðŸ¤” {icon} {item} is already in your cart!",
      removed: "ðŸ—‘ï¸ Removed from cart! Click again to add back!",
      pleaseWriteGuess: "Please write a guess!",
      perfectGuess: "ðŸŽŠ AMAZING! Perfect guess: {recipe}! All ingredients correct! You're a master chef! ðŸ§‘â€ðŸ³ (+10 points)",
      goodGuessMissing: "ðŸŽ¯ Good job! Correct dish: {recipe}! Missing: {missing} - Try to get all ingredients next time! (+5 points)",
      wrongGuess: "ðŸ¤¯ Oops! Wrong guess! The correct answer was: {recipe}. Don't give up, try the next recipe! ðŸ’ª",
      onFire: "ðŸ† You're on fire! Keep going, champion! ðŸ”¥"
    },
    items: {
      "pasta": "pasta",
      "tomato": "tomato",
      "cheese": "cheese",
      "onion": "onion",
      "egg": "egg",
      "milk": "milk",
      "lettuce": "lettuce",
      "cucumber": "cucumber",
      "olive oil": "olive oil",
      "chicken": "chicken",
      "carrot": "carrot",
      "potato": "potato",
      "dough": "dough",
      "olive": "olive",
      "bread": "bread",
      "flour": "flour",
      "sugar": "sugar",
      "apple": "apple",
      "banana": "banana",
      "fish": "fish"
    },
    recipeNames: {
      pasta: "Pasta",
      omelet: "Omelet",
      salad: "Salad",
      soup: "Soup",
      pizza: "Pizza",
      sandwich: "Sandwich",
      cake: "Cake"
    },
    recipeAlternatives: {
      pasta: ["pasta", "spaghetti", "noodles"],
      omelet: ["omelet", "omelette", "scrambled eggs"],
      salad: ["salad", "green salad", "vegetable salad"],
      soup: ["soup", "chicken soup", "broth"],
      pizza: ["pizza"],
      sandwich: ["sandwich", "sub", "toast"],
      cake: ["cake", "sponge cake", "batter cake"]
    }
  },

  tr: {
    title: "AlÄ±ÅŸveriÅŸ MacerasÄ± - SÃ¼permarket Oyunu",
    headerTitle: "AlÄ±ÅŸveriÅŸ MacerasÄ±",
    headerSubtitle: "Tarif kartÄ±ndaki malzemeleri topla ve yemeÄŸi tahmin et!",
    selectLanguage: "Dil SeÃ§in:",
    score: "Puan",
    recipeTitle: "Gizli Tarif",
    supermarketTitle: "Market RaflarÄ±",
    basketTitle: "AlÄ±ÅŸveriÅŸ Sepetim",
    guessPlaceholder: "Bu malzemelerle hangi yemek yapÄ±lÄ±r?",
    guessButton: "Tahmin Et! ðŸ½ï¸",
    newRecipeButton: "Yeni Tarif ðŸ”„",
    missingLabel: "Eksik",
    messages: {
      itemAdded: "ðŸŽ‰ {icon} {item} sepete eklendi! Harika seÃ§im! ðŸŽ‰",
      itemAlready: "ðŸ¤” {icon} {item} zaten sepetinde!",
      removed: "ðŸ—‘ï¸ Sepetten Ã§Ä±karÄ±ldÄ±! Eklemek iÃ§in tekrar tÄ±kla!",
      pleaseWriteGuess: "LÃ¼tfen bir tahmin yaz!",
      perfectGuess: "ðŸŽŠ MUHTEÅžEM! DoÄŸru tahmin: {recipe}! TÃ¼m malzemeler doÄŸru! Harika bir aÅŸÃ§Ä±sÄ±n! ðŸ§‘â€ðŸ³ (+10 puan)",
      goodGuessMissing: "ðŸŽ¯ Aferin! DoÄŸru yemek: {recipe}! Eksik: {missing} - Bir dahaki sefere tÃ¼m malzemeleri toplamayÄ± dene! (+5 puan)",
      wrongGuess: "ðŸ¤¯ Oops! YanlÄ±ÅŸ tahmin! DoÄŸru cevap: {recipe}. Pes etme, sÄ±radaki tarifi dene! ðŸ’ª",
      onFire: "ðŸ† HarikasÄ±n! BÃ¶yle devam et, ÅŸampiyon! ðŸ”¥"
    },
    items: {
      "pasta": "makarna",
      "tomato": "domates",
      "cheese": "peynir",
      "onion": "soÄŸan",
      "egg": "yumurta",
      "milk": "sÃ¼t",
      "lettuce": "marul",
      "cucumber": "salatalÄ±k",
      "olive oil": "zeytinyaÄŸÄ±",
      "chicken": "tavuk",
      "carrot": "havuÃ§",
      "potato": "patates",
      "dough": "hamur",
      "olive": "zeytin",
      "bread": "ekmek",
      "flour": "un",
      "sugar": "ÅŸeker",
      "apple": "elma",
      "banana": "muz",
      "fish": "balÄ±k"
    },
    recipeNames: {
      pasta: "Makarna",
      omelet: "Omlet",
      salad: "Salata",
      soup: "Ã‡orba",
      pizza: "Pizza",
      sandwich: "SandviÃ§",
      cake: "Kek"
    },
    recipeAlternatives: {
      pasta: ["makarna", "spagetti", "spaghetti", "eriÅŸte"],
      omelet: ["omlet", "Ã§Ä±rpÄ±lmÄ±ÅŸ yumurta"],
      salad: ["salata", "yeÅŸil salata", "sebze salatasÄ±"],
      soup: ["Ã§orba", "tavuk Ã§orbasÄ±", "tavuk suyu"],
      pizza: ["pizza"],
      sandwich: ["sandviÃ§", "tost"],
      cake: ["kek", "pandispanya"]
    }
  },

  pl: {
    title: "Przygoda Zakupowa - Gra Supermarket",
    headerTitle: "Przygoda Zakupowa",
    headerSubtitle: "Zbierz skÅ‚adniki z karty przepisu i odgadnij danie!",
    selectLanguage: "Wybierz jÄ™zyk:",
    score: "Wynik",
    recipeTitle: "Tajny Przepis",
    supermarketTitle: "PÃ³Å‚ki w Supermarkecie",
    basketTitle: "MÃ³j Koszyk",
    guessPlaceholder: "Jakie danie moÅ¼na zrobiÄ‡ z tych skÅ‚adnikÃ³w?",
    guessButton: "Zgadnij! ðŸ½ï¸",
    newRecipeButton: "Nowy Przepis ðŸ”„",
    missingLabel: "Brakuje",
    messages: {
      itemAdded: "ðŸŽ‰ {icon} {item} dodano do koszyka! Åšwietny wybÃ³r! ðŸŽ‰",
      itemAlready: "ðŸ¤” {icon} {item} juÅ¼ jest w Twoim koszyku!",
      removed: "ðŸ—‘ï¸ UsuniÄ™to z koszyka! Kliknij ponownie, aby dodaÄ‡!",
      pleaseWriteGuess: "ProszÄ™ wpisz swojÄ… odpowiedÅº!",
      perfectGuess: "ðŸŽŠ WSPANIALE! Trafione: {recipe}! Wszystkie skÅ‚adniki poprawne! JesteÅ› mistrzem kuchni! ðŸ§‘â€ðŸ³ (+10 punktÃ³w)",
      goodGuessMissing: "ðŸŽ¯ Dobra robota! Poprawne danie: {recipe}! Brakuje: {missing} - SprÃ³buj nastÄ™pnym razem zebraÄ‡ wszystkie skÅ‚adniki! (+5 punktÃ³w)",
      wrongGuess: "ðŸ¤¯ Ups! ZÅ‚a odpowiedÅº! Poprawna to: {recipe}. Nie poddawaj siÄ™, sprÃ³buj kolejnego przepisu! ðŸ’ª",
      onFire: "ðŸ† Idzie Å›wietnie! Tak trzymaj, mistrzu! ðŸ”¥"
    },
    items: {
      "pasta": "makaron",
      "tomato": "pomidor",
      "cheese": "ser",
      "onion": "cebula",
      "egg": "jajko",
      "milk": "mleko",
      "lettuce": "saÅ‚ata",
      "cucumber": "ogÃ³rek",
      "olive oil": "oliwa z oliwek",
      "chicken": "kurczak",
      "carrot": "marchewka",
      "potato": "ziemniak",
      "dough": "ciasto",
      "olive": "oliwka",
      "bread": "chleb",
      "flour": "mÄ…ka",
      "sugar": "cukier",
      "apple": "jabÅ‚ko",
      "banana": "banan",
      "fish": "ryba"
    },
    recipeNames: {
      pasta: "Makaron",
      omelet: "Omlet",
      salad: "SaÅ‚atka",
      soup: "Zupa",
      pizza: "Pizza",
      sandwich: "Kanapka",
      cake: "Ciasto"
    },
    recipeAlternatives: {
      pasta: ["makaron", "spaghetti"],
      omelet: ["omlet", "jajecznica"],
      salad: ["saÅ‚atka", "saÅ‚atka warzywna"],
      soup: ["zupa", "rosÃ³Å‚", "zupa z kurczaka"],
      pizza: ["pizza"],
      sandwich: ["kanapka", "sandwich", "tost"],
      cake: ["ciasto", "biszkopt"]
    }
  },

  nl: {
    title: "Winkelavontuur - Supermarktspel",
    headerTitle: "Winkelavontuur",
    headerSubtitle: "Verzamel ingrediÃ«nten van de receptkaart en raad het gerecht!",
    selectLanguage: "Selecteer taal:",
    score: "Score",
    recipeTitle: "Geheim Recept",
    supermarketTitle: "Supermarkt Schappen",
    basketTitle: "Mijn Winkelmand",
    guessPlaceholder: "Welk gerecht kun je met deze ingrediÃ«nten maken?",
    guessButton: "Doe een gok! ðŸ½ï¸",
    newRecipeButton: "Nieuw Recept ðŸ”„",
    missingLabel: "Ontbreekt",
    messages: {
      itemAdded: "ðŸŽ‰ {icon} {item} toegevoegd aan mand! Topkeuze! ðŸŽ‰",
      itemAlready: "ðŸ¤” {icon} {item} zit al in je mand!",
      removed: "ðŸ—‘ï¸ Verwijderd uit mand! Klik opnieuw om toe te voegen!",
      pleaseWriteGuess: "Vul een gok in!",
      perfectGuess: "ðŸŽŠ GEWELDIG! Perfect geraden: {recipe}! Alle ingrediÃ«nten kloppen! Je bent een topchef! ðŸ§‘â€ðŸ³ (+10 punten)",
      goodGuessMissing: "ðŸŽ¯ Goed gedaan! Juist gerecht: {recipe}! Ontbreekt: {missing} - Probeer de volgende keer alle ingrediÃ«nten te pakken! (+5 punten)",
      wrongGuess: "ðŸ¤¯ Oeps! Verkeerd! Het juiste antwoord was: {recipe}. Niet opgeven, probeer het volgende recept! ðŸ’ª",
      onFire: "ðŸ† Je gaat als een speer! Ga zo door, kampioen! ðŸ”¥"
    },
    items: {
      "pasta": "pasta",
      "tomato": "tomaat",
      "cheese": "kaas",
      "onion": "ui",
      "egg": "ei",
      "milk": "melk",
      "lettuce": "sla",
      "cucumber": "komkommer",
      "olive oil": "olijfolie",
      "chicken": "kip",
      "carrot": "wortel",
      "potato": "aardappel",
      "dough": "deeg",
      "olive": "olijf",
      "bread": "brood",
      "flour": "bloem",
      "sugar": "suiker",
      "apple": "appel",
      "banana": "banaan",
      "fish": "vis"
    },
    recipeNames: {
      pasta: "Pasta",
      omelet: "Omelet",
      salad: "Salade",
      soup: "Soep",
      pizza: "Pizza",
      sandwich: "Broodje",
      cake: "Taart"
    },
    recipeAlternatives: {
      pasta: ["pasta", "spaghetti"],
      omelet: ["omelet", "roerei"],
      salad: ["salade", "groene salade"],
      soup: ["soep", "kippensoep", "bouillon"],
      pizza: ["pizza"],
      sandwich: ["broodje", "sandwich", "tosti"],
      cake: ["taart", "cake"]
    }
  },

  lt: {
    title: "Apsipirkimo Nuotykis - Supermarketo Å½aidimas",
    headerTitle: "Apsipirkimo Nuotykis",
    headerSubtitle: "Surink ingredientus iÅ¡ recepto kortelÄ—s ir atspÄ—k patiekalÄ…!",
    selectLanguage: "Pasirinkti kalbÄ…:",
    score: "TaÅ¡kai",
    recipeTitle: "Slaptas Receptas",
    supermarketTitle: "Supermarketo Lentynos",
    basketTitle: "Mano KrepÅ¡elis",
    guessPlaceholder: "KokÄ¯ patiekalÄ… galima pagaminti iÅ¡ Å¡iÅ³ ingredientÅ³?",
    guessButton: "SpÄ—ti! ðŸ½ï¸",
    newRecipeButton: "Naujas Receptas ðŸ”„",
    missingLabel: "TrÅ«ksta",
    messages: {
      itemAdded: "ðŸŽ‰ {icon} {item} pridÄ—ta Ä¯ krepÅ¡elÄ¯! Puikus pasirinkimas! ðŸŽ‰",
      itemAlready: "ðŸ¤” {icon} {item} jau yra tavo krepÅ¡elyje!",
      removed: "ðŸ—‘ï¸ PaÅ¡alinta iÅ¡ krepÅ¡elio! SpustelÄ—k dar kartÄ…, kad pridÄ—tum!",
      pleaseWriteGuess: "Ä®raÅ¡yk spÄ—jimÄ…!",
      perfectGuess: "ðŸŽŠ NUOSTABU! Teisingas spÄ—jimas: {recipe}! Visi ingredientai teisingi! Tu â€“ virtuvÄ—s meistras! ðŸ§‘â€ðŸ³ (+10 taÅ¡kÅ³)",
      goodGuessMissing: "ðŸŽ¯ Å aunu! Teisingas patiekalas: {recipe}! TrÅ«ksta: {missing} - KitÄ… kartÄ… pabandyk surinkti visus ingredientus! (+5 taÅ¡kai)",
      wrongGuess: "ðŸ¤¯ Oi! Neteisinga! Teisingas atsakymas buvo: {recipe}. Nenuleisk rankÅ³, bandyk kitÄ… receptÄ…! ðŸ’ª",
      onFire: "ðŸ† Tau puikiai sekasi! Taip ir toliau, Äempione! ðŸ”¥"
    },
    items: {
      "pasta": "makaronai",
      "tomato": "pomidoras",
      "cheese": "sÅ«ris",
      "onion": "svogÅ«nas",
      "egg": "kiauÅ¡inis",
      "milk": "pienas",
      "lettuce": "salotos",
      "cucumber": "agurkas",
      "olive oil": "alyvuogiÅ³ aliejus",
      "chicken": "viÅ¡tiena",
      "carrot": "morka",
      "potato": "bulvÄ—",
      "dough": "teÅ¡la",
      "olive": "alyvuogÄ—",
      "bread": "duona",
      "flour": "miltai",
      "sugar": "cukrus",
      "apple": "obuolys",
      "banana": "bananas",
      "fish": "Å¾uvis"
    },
    recipeNames: {
      pasta: "Makaronai",
      omelet: "Omletas",
      salad: "Salotos",
      soup: "Sriuba",
      pizza: "Pica",
      sandwich: "SumuÅ¡tinis",
      cake: "Pyragas"
    },
    recipeAlternatives: {
      pasta: ["makaronai", "spageÄiai"],
      omelet: ["omletas", "plakta kiauÅ¡inienÄ—"],
      salad: ["salotos", "darÅ¾oviÅ³ salotos"],
      soup: ["sriuba", "viÅ¡tienos sriuba", "sultinys"],
      pizza: ["pica"],
      sandwich: ["sumuÅ¡tinis", "tostas"],
      cake: ["pyragas", "biskvitas"]
    }
  }
};

let currentLanguage = 'en';

function getText(key) {
  const langTable = translations[currentLanguage] || translations.en;
  return langTable[key] || translations.en[key] || key;
}

function getMessage(key, vars = {}) {
  const msgs = (translations[currentLanguage] && translations[currentLanguage].messages) || translations.en.messages;
  let tmpl = msgs[key] || translations.en.messages[key] || '';
  return tmpl.replace(/\{(\w+)\}/g, (_, v) => vars[v] ?? '');
}

function getItemName(key) {
  const langTable = translations[currentLanguage] || translations.en;
  return (langTable.items && langTable.items[key]) || translations.en.items[key] || key;
}

function getRecipeName(id) {
  const langTable = translations[currentLanguage] || translations.en;
  return (langTable.recipeNames && langTable.recipeNames[id]) || translations.en.recipeNames[id] || id;
}

function getRecipeAlternatives(id) {
  const langTable = translations[currentLanguage] || translations.en;
  return (langTable.recipeAlternatives && langTable.recipeAlternatives[id]) || translations.en.recipeAlternatives[id] || [];
}

function updateUI() {
  document.title = getText('title');
  const html = document.documentElement;
  html.lang = currentLanguage;

  const headerH1 = document.querySelector('.header h1');
  if (headerH1) headerH1.textContent = `ðŸ›’ ${getText('headerTitle')}`;
  const headerP = document.querySelector('.header p');
  if (headerP) headerP.textContent = getText('headerSubtitle');

  const langH3 = document.querySelector('.language-selector h3');
  if (langH3) langH3.textContent = getText('selectLanguage');

  const scoreH3 = document.querySelector('.score h3');
  if (scoreH3) scoreH3.textContent = getText('score');

  const recipeTitle = document.getElementById('recipeTitle');
  if (recipeTitle) recipeTitle.textContent = getText('recipeTitle');

  const marketH2 = document.querySelector('.supermarket h2');
  if (marketH2) marketH2.textContent = `ðŸª ${getText('supermarketTitle')}`;

  const basketH3 = document.querySelector('#basket h3');
  if (basketH3) basketH3.textContent = getText('basketTitle');

  const guessInput = document.getElementById('guessInput');
  if (guessInput) guessInput.placeholder = getText('guessPlaceholder');

  const guessBtn = document.getElementById('guessBtn');
  if (guessBtn) guessBtn.textContent = getText('guessButton');

  const newRecipeBtn = document.getElementById('newRecipeBtn');
  if (newRecipeBtn) newRecipeBtn.textContent = getText('newRecipeButton');
}

function changeLanguage(lang) {
  if (!translations[lang]) return;
  currentLanguage = lang;
  updateUI();
  if (typeof window.refreshLocalizedData === 'function') {
    window.refreshLocalizedData();
  }
}

function initLanguageSelector() {
  const container = document.querySelector('.language-selector');
  if (!container) return;
  // Avoid duplicates
  if (container.querySelector('.language-btn')) return;
  const languages = [
    { code: 'en', name: ' ðŸ‡¬ðŸ‡§ English' },
    { code: 'tr', name: ' ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e' },
    { code: 'pl', name: ' ðŸ‡µðŸ‡± Polski' },
    { code: 'nl', name: ' ðŸ‡³ðŸ‡± Nederlands' },
    { code: 'lt', name: ' ðŸ‡±ðŸ‡¹ LietuviÅ³' }
  ];
  languages.forEach(lang => {
    const btn = document.createElement('button');
    btn.className = 'language-btn';
    btn.textContent = lang.name;
    btn.onclick = () => {
      document.querySelectorAll('.language-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      changeLanguage(lang.code);
    };
    if (lang.code === currentLanguage) btn.classList.add('active');
    container.appendChild(btn);
  });
}
